"use strict";(()=>{const $=document.querySelector.bind(document),$$=document.querySelectorAll.bind(document),COLORS={red:["#ff5174","#ff4a69","#ee9cac",[,,1675,,.06,.24,1,1.82,,,837,.06]],yellow:["#ffe901","#fed702","#fff483",[,,539,0,.04,.29,1,1.92,,,567,.02,.02,,,,.04]],green:["#48d054","#43c04e","#8ff498",[,,1e3,,,.5,,,,,99,.01,.03]],blue:["#009afe","#018fff","#6abcf2",[,.1,75,.03,.08,.17,1,1.88,7.83,,,,,.4]]},SOUNDS={explosion:[,,418,0,.02,.2,4,1.15,-8.5,,,,,.7,,.1],kill:[2.06,,437,,.19,1,2,1.19,.9,.9,,,,.5,,.4,.34,.69,.06,.22]};$("html").style.cssText+="--h: 732px; --w: 412px";const setHtml=(element,html)=>element.innerHTML=html,ObjectKeys=obj=>Object.keys(obj),delay=ms=>new Promise((resolve=>setTimeout(resolve,ms))),generateLink=(label="",url="")=>`<a title=${label} href=${url} target="_blank" rel="noopener noreferrer">${label}</a>`,$on=(target,type,callback,parameter={})=>{target&&target.addEventListener(type,callback,parameter)},addClass=(target,className)=>{target&&className.split(" ").forEach((classText=>{target.classList.add(classText)}))},removeClass=(target,className)=>{target&&className.split(" ").forEach((classText=>{target.classList.remove(classText)}))},getDataCache=()=>{const data=localStorage.getItem("space-war-js13k")||"";return""!==data?JSON.parse(data):{}},savePropierties=(property,value)=>{const localCache=getDataCache();localCache[property]=value;data=localCache,localStorage.setItem("space-war-js13k",JSON.stringify(data));var data},getValueFromCache=(key="",initial)=>getDataCache()[key]||initial,inlineStyles=styles=>ObjectKeys(styles).length?`style='${ObjectKeys(styles).map((v=>`${v}:${styles[v]}`)).join(";")}'`:"",addStyle=(target,styles)=>{if(target)for(let style in styles)target.style[style]=styles[style]},onWindowResize=((fn,delay)=>{var t;return function(){clearTimeout(t);t=setTimeout(fn,delay)}})((()=>{const{w:w,h:h}={w:window.innerWidth,h:window.innerHeight},scale=Math.min(w/412,h/732),mobile=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);addStyle($("body"),{zoom:`${w<412?Math.round(w/412*100):100}%`,transform:scale>=1||mobile?`scale(${mobile?1:scale})`:void 0})}),100),Modal={show({txt:txt,icon:icon="",yes:yes="yes",no:no="no",cb:cb,timer:timer=0}){$("modal .txt").innerHTML=(icon?`<p ${inlineStyles({"font-size":"3rem"})}>${icon}</p>`:"")+txt;addStyle($("modal #btn1"),{display:yes?"block":"none"});addStyle($("modal #btn2"),{display:no?"block":"none"});$("modal #btn1").textContent=yes;$("modal #btn2").textContent=no;removeClass($("modal"),"hide");addClass($("modal"),"show");this.interval&&clearTimeout(this.interval);timer&&(this.interval=setTimeout((()=>{this.hide()}),timer));this.callback=cb},hide(){removeClass($("modal"),"show");addClass($("modal"),"hide");this.interval&&clearTimeout(this.interval)},render:()=>'<modal class="hide wh"><div class="ms wh"></div><div class="mw wh cs"><div class=mc><div class="wh cs txt"></div><div class="mb wh cs"><button id=btn1></button><button id=btn2></button></div></div></div></modal>',events(){$$("modal button").forEach((btn=>$on(btn,"click",(e=>{this.hide();this.callback&&this.callback("btn1"===e.target.id)}))))}},Ship=(number=1,styles={})=>`<div class=s${number} ${inlineStyles(styles)}></div>`,PauseButton=(icon="‚è∏Ô∏è")=>`<button id=pause>${icon}</button>`,Bullets=(id="",styles={})=>`<div class=bullet id=${id} ${inlineStyles(styles)}></div>`,Game=()=>{let intervalPattern,soundPattern=[],counterPattern=0,score=0;const shootLaser=async(ship=1)=>{const laser=$("#laser"),particle=$("#particle"),positionLaser=[260,140],initialPosition=positionLaser[1===ship?1:0],destinityParticle=[[1,-1],[1,1],[-1,1],[-1,-1]];addStyle($(".game"),{animation:"unset"});addStyle(particle,{top:["43%","13%"][ship-1],visibility:"visible"});for(let i=0;i<4;i++)addStyle($(`#b-${i+1}`),{top:"7px",left:"15px",visibility:"hidden",opacity:0,transition:"left .8s ease, top .8s ease, opacity .8s ease",background:"#f5f301",height:"25px",transform:`rotate(${45+90*i}deg)`});addStyle(laser,{left:"49%",top:`${initialPosition}px`,visibility:"visible",opacity:0,transition:"top 0.5s ease, opacity 1s ease"});await delay(70);addStyle(laser,{top:`${positionLaser[ship-1]}px`,opacity:1});await delay(200);laser.style="";for(let i=0;i<4;i++){const element=$(`#b-${i+1}`);addStyle(element,{left:+element.style.left.split("px")[0]+300*destinityParticle[i][0]+"px",top:+element.style.top.split("px")[0]+300*destinityParticle[i][1]+"px",visibility:"visible",opacity:1})}zzfx(...SOUNDS[2===ship?"explosion":"kill"]);if(1==ship){addStyle($(".game"),{animation:"shakeY .5s"});"vibrate"in navigator&&navigator.vibrate(500)}await delay(500);particle.style="";for(let i=0;i<4;i++)$(`#b-${i+1}`).style="";2===ship?setSoundPattern():Modal.show({icon:"üöÄ",txt:`<h2 ${inlineStyles({"margin-bottom":"10px"})}>Destroyed ship.</h2><p><b>You achieved ${score} points</b>, do you want to try again?</p>`,cb(answer){answer?restartGame():Screen()}})},changeButtonsState=(disabled=!1)=>{ObjectKeys(COLORS).forEach((v=>$(`piano #${v}`).disabled=disabled))},setSoundPattern=()=>{let index=0,counter=0;soundPattern.push(ObjectKeys(COLORS)[(min=0,max=3,Math.floor(Math.random()*(max-min+1))+min)]);var min,max;changeButtonsState(!0);intervalPattern&&clearInterval(intervalPattern);intervalPattern=setInterval((()=>{if(index>=soundPattern.length){counterPattern=0;clearInterval(intervalPattern);changeButtonsState(!1)}if(counter%2==0){((color="")=>{""!==color&&zzfx(...COLORS[color][3]);ObjectKeys(COLORS).forEach((async v=>{const element=$(`piano #${v}`);if(color===v){addClass(element,"select");await delay(100);removeClass(element,"select")}else removeClass(element,"select")}))})(soundPattern[index]);index++}counter++}),200)},restartGame=async()=>{soundPattern=[];counterPattern=0;score=0;setHtml($("#score"),score);await delay(200);setSoundPattern()};setHtml($("#render"),`<div class="game cs wh" ${inlineStyles({"flex-direction":"column"})}>\n      ${PauseButton()}\n      ${Bullets("laser")}\n      <div id=particle>\n      ${new Array(4).fill(null).map(((_,i)=>Bullets(`b-${i+1}`))).join("")}\n      </div>\n      <div id=score>0</div>\n      ${new Array(2).fill(null).map(((_,i)=>Ship(i+1,{width:"60px",height:"60px",filter:"drop-shadow(-14px -13px 3px var(--shadow))","margin-bottom":i?"30px":"150px"}))).join("")}\n        <piano class="cs" ${inlineStyles({"flex-wrap":"wrap",width:"80%"})}>${ObjectKeys(COLORS).map((v=>`<button disabled id=${v}></button>`)).join("")}</piano>\n      </div>`);$$("piano button").forEach((btn=>$on(btn,"click",(e=>(async(color="")=>{zzfx(...COLORS[color][3]);changeButtonsState(!0);await delay(200);if(color===soundPattern[counterPattern]){counterPattern++;if(counterPattern<soundPattern.length)changeButtonsState(!1);else{shootLaser(2);score++;setHtml($("#score"),score);const currentScore=+getValueFromCache("score",0);score>currentScore&&savePropierties("score",score)}}else shootLaser(1)})(e.target.id)))));$on($("#pause"),"click",(()=>{intervalPattern&&clearInterval(intervalPattern);Screen()}));setSoundPattern()},Lobby=()=>{setHtml($("#render"),`<div class="cs wh" ${inlineStyles({"flex-direction":"column"})}>\n        ${Ship(1,{width:"100px",height:"100px",filter:"drop-shadow(-14px -13px 3px var(--shadow))","margin-bottom":"40px",animation:"rotation 10s infinite linear"})}\n        <h1 class=logo ${inlineStyles({"margin-bottom":"10px"})}>Space War</h1>\n        <h2>Best Score</h2>\n        <div ${inlineStyles({"font-size":"40px","font-weight":"bold"})}>${getValueFromCache("score",0)}</div>\n        <p class=copy>\n          Press the right button to attack the enemy ship or your ship will be destroyed\n        </p>\n        <button class=button id=game>START GAME</button>\n        <a href=# id=about ${inlineStyles({color:"white","z-index":2,"font-size":"25px","margin-top":"40px"})}>About</a>\n      </div>`);$on($("#game"),"click",(()=>Screen("Game")));$on($("#about"),"click",(e=>{e.preventDefault();Screen("About")}))},About=()=>{setHtml($("#render"),`<div class="cs wh" ${inlineStyles({"flex-direction":"column"})}>\n        ${PauseButton("‚¨ÖÔ∏è")}\n        ${Ship(2,{width:"100px",height:"100px","margin-bottom":"30px"})}\n        <h1 class=logo>Space War</h1>\n        <h3>\n        ${generateLink("By Jorge Rubiano","https://github.com/Jorger")}\n        </h3>\n        <p class=copy>Space War is a game developed for the 2021 edition of the ${generateLink("#JS13K","https://js13kgames.com/")}</p>\n        <div ${inlineStyles({padding:"15px",width:"80%","font-size":"20px","line-height":"1.2","margin-top":"-15px"})}><ul>${[["Twitter","https://twitter.com/ostjh"],["Github","https://github.com/Jorger"],["Linkedin","https://www.linkedin.com/in/jorge-rubiano-a8616319"]].map((v=>`<li ${inlineStyles({"margin-bottom":"5px"})}>${generateLink(v[0],v[1])}</li>`)).join("")}</ul></div>\n      </div>`);$on($("#pause"),"click",(()=>Screen()))},Screen=(screen="Lobby")=>{({Lobby:Lobby,Game:Game,About:About})[screen]()},customClass=`piano button {\n    height: calc(var(--w) * 0.22);\n    width: calc(var(--w) * 0.3);\n    border: none;\n    cursor: pointer;\n    margin: 5%;\n    -webkit-tap-highlight-color: transparent;\n    box-shadow: ${new Array(7).fill(null).map(((_,i)=>`var(--shadow) ${-2*(i+1)}px ${-2*(i+1)}px ${2*(i+1)}px 0px`)).join(",")};\n  }\n  ${ObjectKeys(COLORS).map((v=>`\n    piano button#${v} {\n      background: ${COLORS[v][0]};\n      border-bottom: 10px solid ${COLORS[v][1]};\n    }\n\n    piano button#${v}:active, \n    piano button#${v}.select {\n      border-bottom: 0;\n      background : ${COLORS[v][2]};\n      transform: translateY(4px);\n    }\n  `)).join("")}`,style=document.createElement("style");setHtml(style,customClass);$("head").appendChild(style);setHtml($("#root"),`${Modal.render()}<div id="render" class="wh cs">`);Modal.events();ObjectKeys(getDataCache()).length||savePropierties("score",0);Screen();$on(document,"contextmenu",(event=>event.preventDefault()));$on(window,"resize",onWindowResize);onWindowResize()})();
